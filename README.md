# VK Bot with OpenAI and Google Drive

–í–ö-–±–æ—Ç —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π OpenAI –∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ Google Drive –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞—Ö.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã —Å –ø–æ–º–æ—â—å—é OpenAI GPT
- üìö –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ Google Drive
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ systemd —Å–ª—É–∂–±—É
- üìù –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PDF, DOCX, MD —Ñ–∞–π–ª–æ–≤

## –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ VPS

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
wget https://raw.githubusercontent.com/evseew/VKbotMain/main/deploy.sh
chmod +x deploy.sh
sudo ./deploy.sh
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

1. **–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
cd /root/VKbotMain
nano .env
```

–î–æ–±–∞–≤—å—Ç–µ:
```env
VK_GROUP_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–≥—Ä—É–ø–ø—ã_–≤–∫
OPENAI_API_KEY=–≤–∞—à_–∫–ª—é—á_openai
GOOGLE_FOLDER_ID=id_–ø–∞–ø–∫–∏_google_drive
VK_API_VERSION=5.199
```

2. **–î–æ–±–∞–≤—å—Ç–µ Google Service Account –∫–ª—é—á:**
```bash
nano /root/VKbotMain/service-account-key.json
# –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ JSON —Ñ–∞–π–ª–∞
```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
```bash
./control.sh start
./control.sh status
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
./control.sh start    # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
./control.sh stop     # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞  
./control.sh restart  # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
./control.sh status   # –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞
./control.sh logs     # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
./control.sh check    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ systemd
```bash
sudo systemctl start google-vk-bot
sudo systemctl stop google-vk-bot
sudo systemctl status google-vk-bot
sudo systemctl restart google-vk-bot
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. VK API
1. –°–æ–∑–¥–∞–π—Ç–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
2. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ ‚Üí "–†–∞–±–æ—Ç–∞ —Å API" ‚Üí "–ö–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞"
3. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª—é—á —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
4. –í "Callback API" –≤–∫–ª—é—á–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è: message_new, message_reply

### 2. OpenAI API
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://platform.openai.com
2. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á –≤ —Ä–∞–∑–¥–µ–ª–µ API Keys
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –∞–∫–∫–∞—É–Ω—Ç–∞ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ GPT-3.5/GPT-4

### 3. Google Drive API
1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ Google Cloud Console
2. –í–∫–ª—é—á–∏—Ç–µ Google Drive API
3. –°–æ–∑–¥–∞–π—Ç–µ Service Account –∏ —Å–∫–∞—á–∞–π—Ç–µ JSON –∫–ª—é—á
4. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–∞–ø–∫–æ–π Google Drive —Å email Service Account

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏ –±–æ—Ç–∞
tail -f /root/VKbotMain/logs/bot.log

# –õ–æ–≥–∏ systemd —Å–ª—É–∂–±—ã
journalctl -u google-vk-bot -f

# –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ª–æ–≥–∏
ls /root/VKbotMain/logs/context_logs/
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
```bash
# –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞
./control.sh status

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
./control.sh check

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
ls /root/VKbotMain/local_vector_db/
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
cd /root/VKbotMain
git pull origin main
./control.sh restart
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
./control.sh logs

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
./control.sh check

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cat .env
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å API
- **VK API**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≥—Ä—É–ø–ø—ã –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- **OpenAI**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –ª–∏–º–∏—Ç—ã
- **Google Drive**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ Service Account –Ω–∞ –ø–∞–ø–∫—É

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
```bash
# –û—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã
rm -rf local_vector_db/
./control.sh restart
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
VKbotMain/
‚îú‚îÄ‚îÄ bot.py                    # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞
‚îú‚îÄ‚îÄ .env                      # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ service-account-key.json  # Google Service Account –∫–ª—é—á
‚îú‚îÄ‚îÄ requirements.txt          # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ control.sh               # –°–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ deploy.sh                # –°–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ google-vk-bot.service    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è systemd
‚îú‚îÄ‚îÄ logs/                    # –õ–æ–≥–∏ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ local_vector_db/         # –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ history_vk/              # –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤
```

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- Python 3.8+
- vk-api
- openai
- chromadb
- langchain
- python-dotenv

## –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã —á–µ—Ä–µ–∑ systemd.

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
systemctl is-enabled google-vk-bot

# –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
systemctl enable google-vk-bot

# –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫  
systemctl disable google-vk-bot
```